name: Make Docs

run-name: Make docs on branch - ${{ github.ref_name }}

# when any pushes are made to any branch with changes to the source, notebooks or docs directory
on:
  push:
    paths:
      - "src/**/*.py"
      - "notebooks/**/*.ipynb"
      - "docs/**"
      - ".github/workflows/**"

# set permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:

    # run on linux since simpliest enviroment and no operating system dependencies are required
    runs-on: ubuntu-latest

    steps:

    # get the repo contents
    - uses: actions/checkout@v3

    # install pandoc so nbsphinx will work
    - name: Install PanDoc
      run: "sudo apt-get install pandoc"

    # build the docs with a slightly tweaked custom command
    - uses: ammaraskar/sphinx-action@master
      with:
        pre-build-command: "pip install ."
        docs-folder: "docsrc"
        build-command: "sphinx-build -a -b html . ../../docs"

    # ensure pages configured correctly
    - name: Setup Pages
      uses: actions/configure-pages@v2
      
    # upload docs directory
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v1
      with:
        # Upload contents of docs directory
        path: "docs"
      
    # deploy automatically to GitHub pages
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v1